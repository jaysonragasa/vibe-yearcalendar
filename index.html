<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yearly Calendar</title>
    
    <!-- Load Tailwind CSS FIRST -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Configure Tailwind for class-based dark mode SECOND -->
    <script>
        tailwind.config = {
            darkMode: 'class', // This is the fix!
            theme: {
                extend: {}
            }
        }
    </script>
    
    <!-- Load Tailwind CSS -->
    <!-- <script src="https://cdn.tailwindcss.com"></script> --> <!-- This line is moved up -->
    <style>
        /* Custom styles for the number input spinners */
        input[type='number']::-webkit-inner-spin-button,
        input[type='number']::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type='number'] {
            -moz-appearance: textfield;
        }
        
        /* Ensure consistent height for day cells */
        .day-cell {
            /* width: 2.5rem;  40px */
            height: 2.5rem; /* 40px */
        }
    </style>
</head>
<body class="bg-slate-100 font-sans text-slate-800 dark:bg-slate-900 dark:text-slate-200 transition-colors duration-300">

    <div class="container mx-auto p-4 sm:p-8">

        <!-- Sticky Year Navigation Header -->
        <header id="calendar-header" class="relative sticky top-0 z-10 bg-slate-100/90 dark:bg-slate-800/90 backdrop-blur-sm py-6 mb-8 transition-colors duration-300">
            <div class="flex justify-between items-center max-w-xs mx-auto">
                <!-- Previous Year Button -->
                <button id="prev-year" class="bg-indigo-600 text-white font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-colors">
                    Prev
                </button>
                
                <!-- Year Input -->
                <input type="number" id="year-input" class="text-3xl font-bold text-slate-800 dark:text-slate-100 w-28 text-center bg-transparent border-b-2 border-slate-300 dark:border-slate-600 focus:border-indigo-500 dark:focus:border-indigo-400 focus:outline-none transition-colors" min="1900" max="2100">
                
                <!-- Next Year Button -->
                <button id="next-year" class="bg-indigo-600 text-white font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-colors">
                    Next
                </button>
            </div>
            
            <!-- Dark Mode Toggle Button -->
            <button id="theme-toggle" class="absolute top-1/2 -translate-y-1/2 right-4 sm:right-8 p-2 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                <svg id="theme-icon-light" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"></path><circle cx="12" cy="12" r="5"></circle></svg>
                <svg id="theme-icon-dark" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </header>

        <!-- Calendar Grid -->
        <main id="calendar-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8">
            <!-- Month cards will be generated by JavaScript and inserted here -->
        </main>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calendarGrid = document.getElementById('calendar-grid');
            const yearInput = document.getElementById('year-input');
            const prevYearBtn = document.getElementById('prev-year');
            const nextYearBtn = document.getElementById('next-year');
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');

            let currentYear = new Date().getFullYear();

            /**
             * Gets a list of fixed and calculable Philippine holidays for a given year.
             * Note: Does not include lunar-based holidays (Holy Week, Eid al-Fitr, etc.)
             */
            function getPhilippineHolidays(year) {
                const holidays = {
                    // --- Regular Holidays (Fixed) ---
                    '1-1': "New Year's Day",
                    '4-9': 'Araw ng Kagitingan',
                    '5-1': 'Labor Day',
                    '6-12': 'Independence Day',
                    '11-30': 'Bonifacio Day',
                    '12-25': 'Christmas Day',
                    '12-30': 'Rizal Day',
                    
                    // --- Special Non-Working Days (Fixed) ---
                    '8-21': 'Ninoy Aquino Day',
                    '11-1': "All Saints' Day",
                    '11-2': "All Souls' Day", // Often declared, but common
                    '12-8': 'Feast of the Immaculate Conception',
                    '12-24': "Christmas Eve",
                    '12-31': 'Last Day of the Year',
                };

                // --- Regular Holidays (Calculated) ---
                // National Heroes Day (Last Monday of August)
                const lastDayOfAug = new Date(year, 8, 0); // Day 0 of month 8 (Sept) is last day of Aug
                let lastMonday = lastDayOfAug.getDate();
                // Go backwards from last day until we find a Monday (day 1)
                while (new Date(year, 7, lastMonday).getDay() !== 1) {
                    lastMonday--;
                }
                holidays[`8-${lastMonday}`] = 'National Heroes Day';
                
                return holidays;
            }

            /**
             * Main function to generate and display the 14-month calendar
             */
            function generateCalendar(year) {
                // Clear the existing grid
                calendarGrid.innerHTML = '';
                
                // Get today's date components for highlighting
                const today = new Date();
                const todayDate = today.getDate();
                const todayMonth = today.getMonth();
                const todayYear = today.getFullYear();

                // Loop from December of the previous year (month -1) to January of the next year (month 12)
                // 14 months total
                for (let monthIndex = -1; monthIndex <= 12; monthIndex++) {
                    const date = new Date(year, monthIndex, 1);
                    const monthCard = createMonthCard(date, todayDate, todayMonth, todayYear, year);
                    calendarGrid.appendChild(monthCard);
                }
            }

            /**
             * Creates a single month card element
             */
            function createMonthCard(date, todayDate, todayMonth, todayYear, mainYear) {
                const month = date.getMonth();
                const year = date.getFullYear();
                
                // Get holidays for this specific month's year
                const holidays = getPhilippineHolidays(year);

                const monthName = date.toLocaleString('default', { month: 'long' });
                const fullMonthName = `${monthName} ${year}`;

                // Create month card container
                const card = document.createElement('div');
                
                const isAdjoiningMonthCard = year !== mainYear;

                if (isAdjoiningMonthCard) {
                    card.className = 'bg-slate-200 dark:bg-slate-700 p-4 rounded-xl shadow-lg flex flex-col transition-colors duration-300'; // Darker card bg
                } else {
                    card.className = 'bg-white dark:bg-slate-800 p-4 rounded-xl shadow-lg flex flex-col transition-colors duration-300'; // Normal card bg
                }

                // Create month title
                const title = document.createElement('h3');
                title.className = 'text-xl font-bold text-center text-indigo-700 dark:text-indigo-400 mb-4 transition-colors duration-300';
                title.textContent = fullMonthName;
                card.appendChild(title);

                // Create day headers grid
                const dayHeadersGrid = document.createElement('div');
                dayHeadersGrid.className = 'grid grid-cols-7 gap-1 mb-2';
                const dayNames = ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'];
                
                dayNames.forEach((day, index) => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'text-sm font-semibold uppercase text-center text-slate-500 dark:text-slate-400 transition-colors duration-300';
                    // Highlight "Su" and "Sa" headers in red
                    if (index === 0 || index === 6) {
                        dayHeader.classList.add('text-red-500', 'dark:text-red-400');
                    }
                    dayHeader.textContent = day;
                    dayHeadersGrid.appendChild(dayHeader);
                });
                card.appendChild(dayHeadersGrid);

                // Create days grid
                const daysGrid = document.createElement('div');
                daysGrid.className = 'grid grid-cols-7 gap-y-1';
                
                // --- Calculate days to display ---
                
                // Find the first day of the month (0-6, Sun-Sat)
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                
                // Start date for the grid (will be a Sunday)
                const startDate = new Date(year, month, 1);
                startDate.setDate(startDate.getDate() - firstDayOfMonth);

                // Fill the 6x7 grid (42 days)
                for (let i = 0; i < 42; i++) {
                    const dayCell = document.createElement('div');
                    const currentDate = new Date(startDate);
                    
                    const day = currentDate.getDate();
                    const dayOfWeek = currentDate.getDay();
                    const currentMonth = currentDate.getMonth();
                    const currentYear = currentDate.getFullYear();

                    // Check for holiday
                    const holidayKey = `${currentMonth + 1}-${day}`;
                    const holidayName = holidays[holidayKey];

                    // --- Apply Styling ---
                    
                    // Base classes for all day cells
                    dayCell.className = 'day-cell flex items-center justify-center rounded-full text-sm font-medium transition-colors duration-150';

                    const isToday = day === todayDate && month === todayMonth && year === todayYear;
                    const isCurrentMonth = month === currentMonth;
                    const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;

                    if (isToday) {
                        // "Today" Highlight (Spec 6)
                        dayCell.classList.add('bg-indigo-600', 'dark:bg-indigo-500', 'text-white', 'font-bold', 'shadow-md');
                        if (holidayName) {
                            dayCell.setAttribute('title', holidayName); // Add holiday name to tooltip
                        }
                    } else if (holidayName && isCurrentMonth) {
                        // Holiday Highlight (and not today)
                        dayCell.classList.add('text-green-600', 'dark:text-green-500', 'font-bold', 'cursor-pointer', 'hover:bg-green-100', 'dark:hover:bg-slate-700', 'focus:bg-green-100', 'dark:focus:bg-slate-700', 'focus:outline-none');
                        dayCell.setAttribute('title', holidayName);
                    } else if (isCurrentMonth) {
                        // Current month's dates
                        dayCell.classList.add('cursor-pointer', 'hover:bg-indigo-100', 'dark:hover:bg-slate-700', 'focus:bg-indigo-100', 'dark:focus:bg-slate-700', 'focus:outline-none');
                        
                        if (isWeekend) {
                            // Weekend Highlighting (Spec 4)
                            dayCell.classList.add('text-red-500', 'dark:text-red-400');
                        } else {
                            // Standard weekday
                            dayCell.classList.add('text-slate-700', 'dark:text-slate-200');
                        }
                    } else {
                        // Adjoining Month Styling (Spec 5)
                        
                        // On a regular month card, adjoining days get the gray bg
                        // On the adjoining month cards, they don't need a separate bg
                        if (!isAdjoiningMonthCard) {
                            dayCell.classList.add('bg-slate-50', 'dark:bg-slate-800');
                        }
                        dayCell.classList.add('text-slate-400', 'dark:text-slate-500', 'cursor-default');
                        if (holidayName) {
                            dayCell.setAttribute('title', holidayName); // Also show tooltips for adjoining holidays
                        }
                    }
                    
                    dayCell.textContent = day;
                    daysGrid.appendChild(dayCell);

                    // Move to the next day
                    startDate.setDate(startDate.getDate() + 1);
                }

                card.appendChild(daysGrid);
                return card;
            }

            // --- Event Listeners ---

            prevYearBtn.addEventListener('click', () => {
                currentYear--;
                yearInput.value = currentYear;
                generateCalendar(currentYear);
            });

            nextYearBtn.addEventListener('click', () => {
                currentYear++;
                yearInput.value = currentYear;
                generateCalendar(currentYear);
            });

            yearInput.addEventListener('change', () => {
                const year = parseInt(yearInput.value, 10);
                if (!isNaN(year) && year >= 1900 && year <= 2100) {
                    currentYear = year;
                    generateCalendar(currentYear);
                } else {
                    // Reset to a valid year if input is bad
                    yearInput.value = currentYear;
                }
            });

            // --- Theme Toggling ---
            
            function applyTheme(theme) {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    themeIconLight.classList.remove('hidden');
                    themeIconDark.classList.add('hidden');
                } else {
                    document.documentElement.classList.remove('dark');
                    themeIconLight.classList.add('hidden');
                    themeIconDark.classList.remove('hidden');
                }
            }

            function initializeTheme() {
                const storedTheme = localStorage.getItem('theme');
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

                if (storedTheme === 'dark') {
                    applyTheme('dark');
                } else if (storedTheme === 'light') {
                    applyTheme('light');
                } else if (systemPrefersDark) {
                    applyTheme('dark');
                } else {
                    applyTheme('light');
                }
            }

            themeToggleBtn.addEventListener('click', () => {
                const isDarkMode = document.documentElement.classList.contains('dark');
                if (isDarkMode) {
                    applyTheme('light');
                    localStorage.setItem('theme', 'light');
                } else {
                    applyTheme('dark');
                    localStorage.setItem('theme', 'dark');
                }
            });

            // Listen for system theme changes (if user hasn't set a preference)
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                const storedTheme = localStorage.getItem('theme');
                if (!storedTheme) { // Only apply if user hasn't made a manual choice
                    applyTheme(e.matches ? 'dark' : 'light');
                }
            });


            // --- Initial Load ---
            yearInput.value = currentYear;
            generateCalendar(currentYear);
            initializeTheme();
        });
    </script>
</body>
</html>
